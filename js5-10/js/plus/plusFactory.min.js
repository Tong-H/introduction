"use strict";angular.module("app").factory("plusFactory",function(d,b,a,c){return{plusEdit_Http:function(e){d.get(c.plusEditid_url+b.id).then(function(f){e.item.title=f.data.data.article.title;e.item.type=f.data.data.article.type+"";e.item.img=f.data.data.article.img;editor.txt.html(f.data.data.article.content);e.item.url=f.data.data.article.url;e.item.industry=f.data.data.article.industry+"";e.item.createAt=f.data.data.article.createAt;document.getElementById("preview").src=e.item.img;e.item.type!=3?e.item.industryHide=true:e.item.industryHide=false},function(){bootbox.alert("服务端获取失败请稍后再试")})},imgUpload:function(h,g){var f=document.getElementById("upload").files[0];var e=new FormData();e.append("file",f);var i=new XMLHttpRequest();i.open("POST",c.plusImgUpload_url,true);i.onload=function(){if(i.status==200){h.no=true;h.ok=false;g.$apply();h.item.img=JSON.parse(i.responseText).data.url}else{h.no=false;h.ok=true}};i.upload.onprogress=function(k){k=k||event;if(k.lengthComputable){var j=Math.floor(k.loaded/k.total*100);$("progress").val(j)}};i.send(e)},imgDelete:function(e){e.ok=true;e.no=true;document.getElementById("preview").src="";e.item.url="";$("#plusList").css("display","none");$("progress").val(0)},typeClick:function(e){e.item.type!=3?e.item.industryHide=true:e.item.industryHide=false},online1:function(e,g){g.item.content=editor.txt.html();g.item.status=e;var f=/^((ht|f)tps?):\/\/([\w\-]+(\.[\w\-]+)*\/)*[\w\-]+(\.[\w\-]+)*\/?(\?([\w\-\.,@?^=%&:\/~\+#]*)+)?/;if(g.item.type==4||g.item.industry==4&&g.item.industryHide==false||g.item.title==undefined||g.item.img==undefined||f.test(g.item.url)==false){bootbox.alert("请完整填写表单")}else{d({method:"PUT",url:c.plusOnline_url+b.id,params:g.item}).then(function(){a.go("master",{},{reload:true})},function(){bootbox.alert("上传失败")})}},online2:function(e,f){f.item.content=editor.txt.html();f.item.status=e;if(f.item.type==4||f.item.industry==4&&f.item.industryHide==false||f.item.title==undefined||f.item.img==undefined||f.item.url==undefined){bootbox.alert("请完整填写表单")}else{d({method:"post",url:c.plusOnline_url,params:f.item}).then(function(){a.go("master",{},{reload:true})},function(){bootbox.alert("上传失败")})}},cancel:function(){a.go("master",{},{reload:true})}}});